import{X as T,Q as f,L as w}from"./constants-BFeFKoYB.js";let l=0,h=0,r=120,I,E,p,D;const d=document.getElementById("chatBox"),m=document.getElementById("choices"),H=document.getElementById("scoreDisplay"),y=document.getElementById("timeRemaining"),q=document.getElementById("hackedScreen");document.getElementById("endMessage");const N=document.getElementById("failedMessage");function L(){let t=localStorage.getItem("loggedInUserID");if(!t){alert("Please log in to play the game.");return}let e=new Date().toISOString().split("T")[0],[o,n,a]=e.split("-"),s=`${a}-${n}-${o}`,c=`https://app.nocodb.com/api/v2/tables/${w}/records?offset=0&limit=10&where=(UserID,eq,${t})~and(Date,eq,${s})&viewId=vwtanjh1wqnn2y29&sort=-Score`;$.ajax({url:c,method:"GET",headers:{"xc-token":T},success:function(g){g.list.length>0?alert("You have already played today. Please try again tomorrow!"):(l=1,h=0,r=120,S(),A(),M(),E=new Date)},error:function(g){console.error("Error fetching data:",g),alert("An error occurred. Please try again later.")}})}function S(){H.textContent=`Score: ${h}`}function A(){I=setInterval(()=>{r--;const t=Math.floor(r/60),e=r%60,o=`${t}:${e.toString().padStart(2,"0")}`;r<60?y.style.color="red":y.style.color="",y.innerText=`Time: ${o}`,r<=0&&(clearInterval(I),B())},1e3)}function O(t,e,o=30,n){let a=0;t.innerHTML="";const s=setInterval(()=>{a<e.length?(t.innerHTML+=e.charAt(a),a++,i()):(clearInterval(s),i(),n&&n())},o)}function i(){d.scrollTop=d.scrollHeight}function P(t){const e=f[l-1],o=e.options[t],n=document.createElement("div");n.className="message you",n.innerHTML=`<div class="message-content">You: ${o}</div>`,d.appendChild(n),i();const a=t===e.answer;let s="";a?(h+=10,S(),s="Correct! Good decision."):(r-=10,s="Incorrect. This approach may lead to complications.");const c=document.createElement("div");c.className="message it-security",c.innerHTML=`<div class="message-content">IT Security: ${s}</div>`,d.appendChild(c),i(),a?(l++,l<=f.length?setTimeout(M,1500):b()):r<=0&&B()}function j(){m.querySelectorAll(".choice-button").forEach(e=>{e.disabled=!0,e.style.opacity="0.5",e.style.cursor="not-allowed",e.title="Wait for the question to complete"})}function G(){m.querySelectorAll(".choice-button").forEach(e=>{e.disabled=!1,e.style.opacity="1",e.style.cursor="pointer",e.title="Click to select this option"})}function M(){if(l>f.length){b();return}const t=f[l-1];let e=t.options.map((n,a)=>`
    <button class="choice-button" data-choice="${a}" disabled title="Wait for the question to complete">${n}</button>
  `).join("");const o=document.createElement("div");o.className="message it-security",o.innerHTML='<div class="message-content"></div>',d.appendChild(o),m.innerHTML=e,j(),O(o.querySelector(".message-content"),`IT Security: ${t.question}`,30,G),i()}function B(){window.location.href="hacked.html"}async function R(){let e=$("#scoreDisplay").text().replace("Score: ","");if(!p){console.error("endTime is not defined");return}let o=Math.floor((p-E)/1e3);D=o;let n=localStorage.getItem("loggedInUserID"),a=localStorage.getItem("loggedInUser");if(!n||!a){console.error("User ID or User Name is missing from localStorage");return}let s=new Date().toISOString().split("T")[0],[c,g,U]=s.split("-"),C=`${U}-${g}-${c}`,x={UserID:n,UserName:a,Date:C,Score:e,TimeTaken:o};try{let u=await $.ajax({url:`https://app.nocodb.com/api/v2/tables/${w}/records`,type:"POST",headers:{"xc-token":T,"Content-Type":"application/json"},data:JSON.stringify(x)});console.log("Data saved successfully:",u)}catch(u){console.error("Error saving data:",u),u.responseJSON&&console.error("Server response:",u.responseJSON)}}async function b(t){clearInterval(I),m.style.display="none",p=new Date;{let e=localStorage.getItem("loggedInUserID"),o=localStorage.getItem("loggedInUser");e&&await R(),window.location.href=`cong.html?name=${encodeURIComponent(o)}&score=${h}&time=${D}`}i()}function v(){l=0,h=0,r=120,S(),clearInterval(I),y.innerText="Time: 2:00",y.style.color="",d.innerHTML=`<div class="message it-security"><div class="message-content">Welcome to the AI Security Challenge. Click 'Start the challenge' to begin.</div></div>`,m.innerHTML="",q.style.display="none",N.style.display="none",i()}function k(){var t=document.getElementById("navLinks");t.classList.toggle("show");var e=document.querySelector(".menu-button"),o=t.classList.contains("show");e.setAttribute("aria-expanded",o)}function J(){document.getElementById("endMessage").style.display="none"}function W(){window.location.href="hacked.html"}document.addEventListener("DOMContentLoaded",()=>{document.getElementById("startButton").addEventListener("click",L),document.getElementById("resetButton").addEventListener("click",v),document.getElementById("menuButton").addEventListener("click",k),m.addEventListener("click",t=>{if(t.target.classList.contains("choice-button")){const e=parseInt(t.target.getAttribute("data-choice"));P(e)}}),alert("This is a simulation for educational purposes only. In a real ransomware situation, never pay the ransom and immediately contact cybersecurity professionals and law enforcement."),v()});window.startChallenge=L;window.resetGame=v;window.toggleMenu=k;window.closeEndMessage=J;window.redirectToHackedPage=W;var _=function(){var t=localStorage.getItem("loggedInUserID"),e=localStorage.getItem("loggedInUser"),o=function(){e=localStorage.getItem("loggedInUser"),t=localStorage.getItem("loggedInUserID"),console.log(t,e),e&&t&&(console.log("User is logged in"),$("#dashboard-name").text("Hello "+e))},n=function(){e&&t&&(localStorage.removeItem("loggedInUser"),localStorage.removeItem("loggedInUserID"),window.location.href=document.location.origin+"/login.html")},a=function(){$("#dashboard-name").click(function(){n()})},s=function(){o(),a()};return{init:s}}();$(document).ready(function(){_.init()});
